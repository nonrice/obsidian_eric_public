To minimize spending, It is best to avoid using the spell whenever you can. So, when can you not avoid using the spell? For every monster $i$, in order to kill it you cannot avoid using the spell within the range $[k_i-h_i+1, k_i]$, since then you cannot charge up enough damage. By merging the ranges for all monsters, you obtain a conclusive set of disjoint ranges in which you must use the spell. Then, all that's left to do is calculate how much mana is spent. You can quickly do this by using summation formula.